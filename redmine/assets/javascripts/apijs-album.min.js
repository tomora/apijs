/**
 * Copyright 2008-2014 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * https://www.luigifab.fr/redmine/apijs - 5.1.0
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
function apijsInitTranslations(){apijs.i18n.data.en.deleteTitle="Delete a file",apijs.i18n.data.es.deleteTitle="Borrar un archivo",apijs.i18n.data.fr.deleteTitle="Supprimer un fichier",apijs.i18n.data.en.deleteText="Are you sure you want to delete this file?[br]Be careful, you can't cancel this operation.",apijs.i18n.data.es.deleteText="Está usted seguro-a de que desea eliminar este archivo?[br]Tenga cuidado, pues no podrá cancelar esta operación.",apijs.i18n.data.fr.deleteText="Êtes-vous certain de vouloir supprimer ce fichier ?[br]Attention, cette opération n'est pas annulable.",apijs.i18n.data.en.errorTitle="Error",apijs.i18n.data.fr.errorTitle="Erreur",apijs.i18n.data.en.error403="You are not authorized to perform this operation, please [a §]refresh the page[/a].",apijs.i18n.data.es.error403="No está autorizado-a para llevar a cabo esta operación, por favor [a §]actualice la página[/a].",apijs.i18n.data.fr.error403="Vous n'êtes pas autorisé(e) à effectuer cette opération, veuillez [a §]actualiser la page[/a].",apijs.i18n.data.en.error404="Sorry, the file no longer exists, please [a §]refresh the page[/a].",apijs.i18n.data.es.error404="Lo sentimos, pero el archivo ya no existe, por favor [a §]actualice la página[/a].",apijs.i18n.data.fr.error404="Désolé, le fichier n'existe plus, veuillez [a §]actualiser la page[/a].",apijs.i18n.data.en.sendTitle="Send multiple files",apijs.i18n.data.es.sendTitle="Enviar varios archivos",apijs.i18n.data.fr.sendTitle="Envoyer plusieurs fichiers",apijs.i18n.data.en.sendText="§ files saved. Finish your changes before save the form or simply [a §]reload[/a] the page.",apijs.i18n.data.fr.sendText="§ fichiers enregistrés. Terminez vos modifications avant d'enregistrer le formulaire ou [a §]rechargez[/a] simplement la page.",apijs.i18n.data.en.editTitle="Edit a description",apijs.i18n.data.es.editTitle="Editar una descripción",apijs.i18n.data.fr.editTitle="Modifier une description",apijs.i18n.data.en.editText="Enter below the new description for the file. To remove the description, leave the field empty.",apijs.i18n.data.es.editText="Introducir a continuación la nueva descripción para el archivo. Para eliminar la descripción, deje el campo en blanco.",apijs.i18n.data.fr.editText="Saisissez ci-dessous la nouvelle description pour ce fichier. Pour supprimer la description, laissez le champ vide."}function apijsShowError(e){"number"==typeof e||e.indexOf("<!DOCTYPE")<0?apijs.dialog.dialogInformation(apijs.i18n.translate("errorTitle"),"number"==typeof e?apijs.i18n.translate("error"+e,"href='javascript:location.reload();'"):e,"error"):(apijs.dialog.styles.remove("lock"),location.reload())}function apijsSendZip(e,a,t){"string"!=typeof apijs.i18n.data.en.sendTitle&&apijsInitTranslations(),apijs.config.upload.tokenValue=a,apijs.upload.sendFile(apijs.i18n.translate("sendTitle"),e,"mybigzip",t,"zip",apijsFinalZip)}function apijsFinalZip(e){apijs.dialog.dialogInformation(apijs.i18n.translate("sendTitle"),apijs.i18n.translate("sendText",e,"href='javascript:location.reload();'"))}function apijsEditAttachment(e,a,t){"string"!=typeof apijs.i18n.data.en.editTitle&&apijsInitTranslations();var i,n=document.getElementById("attachmentId"+e).querySelector("span.description").firstChild.nodeValue.trim();i='[p][label for="apijsRedText"]'+apijs.i18n.translate("editText")+"[/label][/p]",i+='[input type="text" name="description" value="'+n+'" spellcheck="true" id="apijsRedText"]',apijs.dialog.dialogFormOptions(apijs.i18n.translate("editTitle"),i,a,apijsActionEditAttachment,[a,e,t],"editattachment"),apijs.dialog.tagDialog.querySelector("input").select()}function apijsActionEditAttachment(e,a){if("boolean"==typeof e)return!0;if("string"==typeof e){var i=new XMLHttpRequest;i.open("POST",a[0]+"?id="+a[1]+"&isAjax=true",!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("X-CSRF-Token",a[2]),i.onreadystatechange=function(){var e,a,t;4===i.readyState&&200===i.status?0===i.responseText.indexOf("attachmentId")?(a=i.responseText.slice(0,i.responseText.indexOf(":")),t=i.responseText.slice(i.responseText.indexOf(":")+1),(e=document.getElementById(a).querySelector("span.description").firstChild).replaceData(0,e.length,t),(e=document.getElementById(a).querySelector("input"))&&(e.value=e.value.slice(0,e.value.lastIndexOf("|")+1)+t),(e=document.getElementById(a).querySelector("img"))&&e.setAttribute("alt",t),apijs.dialog.actionClose()):apijsShowError(i.responseText):4===i.readyState&&403===i.status?apijsShowError(403):4===i.readyState&&404===i.status&&apijsShowError(404)},i.send("description="+encodeURIComponent(document.getElementById("apijsRedText").value))}}function apijsDeleteAttachment(e,a,t){"string"!=typeof apijs.i18n.data.en.deleteTitle&&apijsInitTranslations(),apijs.dialog.dialogConfirmation(apijs.i18n.translate("deleteTitle"),apijs.i18n.translate("deleteText"),apijsActionDeleteAttachment,[a,e,t])}function apijsActionDeleteAttachment(e){var s=new XMLHttpRequest;s.open("GET",e[0]+"?id="+e[1]+"&isAjax=true",!0),s.setRequestHeader("X-CSRF-Token",e[2]),s.onreadystatechange=function(){if(4===s.readyState&&200===s.status)if(0===s.responseText.indexOf("attachmentId")){var e,a,t,i=document.getElementById(s.responseText),n=i.parentNode,r=0;if(n.removeChild(i),e=n.querySelectorAll("a[id][type]"),n.querySelectorAll("dl,li").length<1)n.style.display="none";else if(0<e.length)for(a in e)e.hasOwnProperty(a)&&"length"!==a&&(t=e[a].getAttribute("id"),e[a].setAttribute("id",t.slice(0,t.lastIndexOf(".")+1)+r++));apijs.dialog.actionClose()}else apijsShowError(s.responseText);else 4===s.readyState&&403===s.status?apijsShowError(403):4===s.readyState&&404===s.status&&apijsShowError(404)},s.send()}